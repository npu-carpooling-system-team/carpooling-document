<div align="center">
    <h1>
        西工大拼车系统_架构设计
    </h1>
    <h3>
        王旻安 2023.4.10
    </h3>
</div>

## 1. 前端

### 1.1 前端技术栈

+ 使用Vue3 + Vite + ElementPlus进行框架搭建
+ 预计将调用阿里云OSS与高德地图导航API来分别实现对象存储与路径规划展示



### 1.2 前端框架

为简单的单体前端应用。



## 2. 后端

### 2.1 后端技术栈

+ SpringBoot 3.0.2, SpringCloud 2022.2, SpringCloud Alibaba 2022.0.0.0-RC1



### 2.2 服务拆分

+ carpooling-parent 总模块，其余所有模块都是下属module，规定依赖版本
+ carpooling-base 基础模块，用于定义Web基础Config，页面返回状态，常量Enum，基础工具，Exception统一处理，只继承parent，无启动类，无需注册。
+ carpooling-gateway 网关模块，需要声明security-config来执行白名单过滤。需要引入JWT鉴权配置，但只做验证不做分发。
+ carpooling-auth security模块。用于完成用户名-密码，手机号-短信，第三方认证登录三项登录请求。同时满足用户管理要求。单体模块不进一步拆分。
+ carpooling-search 数据查询模块。主要负责将数据库中拼车内容引入ES并提供搜索
+ carpooling-carpooling 提供拼车信息的增删改，分体模块，分API-MODEL-SERVICE，注意要完成管理端的数据导出功能
+ carpooling-status 提供订单状态的CRUD，订单预约-司机审核-订单开始-订单结束-完成支付-互相评价API-MODEL-SERVICE
+ carpooling-payment 支付模块 支付宝SDK 单体模块 XXL-JOB完成本来`@Schedule`的操作



### 2.3 数据库规划

我记得阿里巴巴规范说在数据库设计时不应该使用外键，所有要利用外键来实现的级联业务应当使用代码完成。

#### 2.3.1 login_account

用于用户名密码登录所需表格

| 列名       | 数据类型               | key类型 | 备注                             |
| ---------- | ---------------------- | ------- | -------------------------------- |
| id         | bigint 用户编号        | primary | auto increment 简化mysql构建索引 |
| username   | varchar255 用户手机号  |         | not null, unique                 |
| password   | varchar255 用户密码    |         | not null                         |
| role       | int 用户角色           | 外键    | not null 需要引入Enum            |
| is_deleted | tinyint 账号是否已删除 |         | 逻辑删除字段 0未删除 1已删除     |



#### 2.3.2 admin

管理员表——我现在这个想想好像不是很需要，但姑且留着



#### 2.3.3 user

常规用户表

| 列名         | 数据类型                    | key类型 | 备注                             |
| ------------ | --------------------------- | ------- | -------------------------------- |
| id           | bigint 用户编号             | primary | auto increment 简化mysql构建索引 |
| username     | varchar255 用户手机号       |         | not null, unique                 |
| user_image   | varchar255 用户头像存储地址 |         | not null, default 那张00.png     |
| email        | varchar255 用户邮箱         |         | 用于发送通知邮件                 |
| github_id    | varchar255 github返回id     |         | 用于第三方登录                   |
| is_driver    | boolean 是否是司机          |         | not null, default false          |
| is_passenger | boolean 是否是乘客          |         | not null, default false          |
| is_deleted   | tinyint 账号是否已删除      |         | 逻辑删除字段 0未删除 1已删除     |



#### 2.3.4 driver

司机表

| 列名               | 数据类型                     | key类型 | 备注                             |
| ------------------ | ---------------------------- | ------- | -------------------------------- |
| id                 | bigint 唯一编号              | primary | auto increment 简化mysql构建索引 |
| driver_id          | bigint 司机编号              |         | not null 与user表中的一致        |
| personal_id        | varchar18 司机身份证号       |         | not null, unique                 |
| drivers_license_no | varchar12 司机驾驶证号       |         | not null,unique                  |
| driver_confirmed   | boolean 司机是否完成人证核验 |         | not null, default false          |
| driver_expire_date | datetime 司机证件过期时间    |         | 最早过期的证件时间               |
| avg_score          | tinyint 司机评分             |         | 五分制                           |
| total_passenger    | bigint 司机总共接到乘客数    |         | not null default 0               |
| is_deleted         | tinyint 账号是否已删除       |         | 逻辑删除字段 0未删除 1已删除     |



#### 2.3.5 carpooling

拼车情况表

| 列名             | 数据类型                        | key类型 | 备注                             |
| ---------------- | ------------------------------- | ------- | -------------------------------- |
| id               | bigint 拼车情况                 | primary | auto increment 简化mysql构建索引 |
| driver_id        | bigint 司机用户编号             |         | not null                         |
| departure_time   | datetime 发车时间               |         | not null                         |
| arrive_time      | datetime 到达时间               |         | not null                         |
| departure_campus | varchar10 出发地点              |         | not null default 长安校区        |
| arrive_campus    | varchar10 到达地点              |         | not null default 友谊校区        |
| passing_point    | varchar255 途经点               |         | JSON数组字符串存储               |
| description      | varchar255 司机对本订单描述     |         |                                  |
| passenger_num    | int 剩余能同时支持的乘客数量    |         |                                  |
| price            | int 单位为元 是的我们不考虑小数 |         | not null, default 0              |



#### 2.3.6 order

拼车订单表

| 列名         | 数据类型                   | key类型 | 备注                             |
| ------------ | -------------------------- | ------- | -------------------------------- |
| id           | bigint 拼车订单            | primary | auto increment 简化mysql构建索引 |
| passenger_id | bigint 用户编号            |         |                                  |
| status       | int 订单当前状态           |         | not null default 未支付 Enum     |
| create_time  | datetime 订单时间          |         | not null default                 |
| update_time  | datetime 订单状态更新时间  |         |                                  |
| score        | tinyint 订单完成后用户打分 |         | 五分制                           |



## 3. 补充

### 3.1 中英文对应用词规范

+ 司机 driver
+ 乘客 passenger
+ 拼车 carpooling
+ 订单 order
+ 启程离开 departure
+ 到达 arrive
+ 途经点 passing point